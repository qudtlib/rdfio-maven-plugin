<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
    <id>mainTasks</id>
    <steps>
        <add>
            <file>src/build/inference/inferApplicableUnits.ttl</file>
            <toGraph>shapes:applicableUnits</toGraph>
        </add>
        <add>
            <file>src/main/rdf/validation/qudt-shacl-functions.ttl</file>
            <toGraph>shacl:qudtFunctions</toGraph>
        </add>
        <shaclInfer>
            <message>Inferring qudt:applicableUnit triples (non-currency units)</message>
            <shapes><graph>shapes:applicableUnits</graph></shapes>
            <data>
                <files>
                    <include>
                        src/main/rdf/vocab/currency/VOCAB_QUDT-UNITS-CURRENCY.ttl
                    </include>
                </files>
            </data>
            <inferred>
                <graph>inferred:applicableUnits</graph>
                <file>target/inferred/applicableUnits.ttl</file>
            </inferred>
        </shaclInfer>
        <savepoint><id>applicableUnits</id></savepoint>
        <shaclInfer>
            <message>Inferring qudt:applicableUnit triples (currency units)</message>
            <shapes><graph>shapes:applicableUnits</graph></shapes>
            <data>
                <files>
                    <include>
                        src/main/rdf/vocab/unit/*.ttl
                        src/main/rdf/vocab/quantitykinds/*.ttl
                    </include>
                </files>
            </data>
            <inferred>
                <graph>inferred:applicableCurrencyUnits</graph>
                <file>target/inferred/applicableUnits-currency.ttl</file>
            </inferred>
        </shaclInfer>
        <savepoint><id>applicableUnits-currencies</id></savepoint>
        <shaclInfer>
            <message>Performing our custom subset of OWL inferences</message>
            <shapes>
                <file>src/build/inference/owl-subset.shapes.ttl</file>
            </shapes>
            <data>
                <files>
                    <include>
                        src/main/rdf/schema/SCHEMA_QUDT.ttl
                        src/main/rdf/vocab/unit/VOCAB_QUDT-UNITS-ALL.ttl
                    </include>
                </files>
            </data>
            <inferred>
                <graph>inferred:owl-subset-units</graph>
                <file>target/inferred/owl-subset-units.ttl</file>
            </inferred>
        </shaclInfer>
        <savepoint>
            <id>owl-subset-units</id>
        </savepoint>
        <add>
            <graph>inferred:owl-subset-units</graph>
            <graph>inferred:applicableUnits</graph>
            <toGraph>target:units</toGraph>
        </add>
        <add>
            <graph>inferred:applicableCurrencyUnits</graph>
            <toGraph>target:currencyUnits</toGraph>
        </add>
        <write>
            <graph>target:currencyUnits</graph>
            <toFile>target/dist/vocab/currency/currencyUnits.ttl</toFile>
        </write>
        <add>
            <file>src/build/inference/factorUnits/predefined-factors-and-scalings.ttl</file>
            <toGraph>target:units</toGraph>
        </add>
        <add>
            <file>target/dist/vocab/prefixes/*.ttl</file>
            <toGraph>target:prefixes</toGraph>
        </add>
        <shaclInfer>
            <message>Inferring qudt:hasFactorUnit</message>
            <shapes>
                <file>target/srcgen/factorUnits/infer.ttl</file>
                <graph>shacl:qudtFunctions</graph>
            </shapes>
            <data>
                <graphs>
                    <include>
                        target:units
                        target:prefixes
                    </include>
                </graphs>
            </data>
            <inferred>
                <graph>inferred:factorUnits</graph>
                <file>target/inferred/factorUnits.ttl</file>
            </inferred>
        </shaclInfer>
        <add>
            <graph>inferred:factorUnits</graph>
            <toGraph>target:units</toGraph>
        </add>
        <shaclInfer>
            <message>Inferring qudt:scalingOf</message>
            <shapes>
                <file>target/srcgen/scalingOf/infer.ttl</file>
                <graph>shacl:qudtFunctions</graph>
            </shapes>
            <data>
                <graph>target:units</graph>
                <graph>target:prefixes</graph>
            </data>
            <inferred>
                <graph>inferred:scalingOf</graph>
                <file>target/inferred/scalingOf.ttl</file>
            </inferred>
        </shaclInfer>
        <add>
            <graph>inferred:scalingOf</graph>
            <toGraph>target:units</toGraph>
        </add>
        <shaclInfer>
            <message>Inferring qudt:conversionMultiplier</message>
            <repeatUntilStable>true</repeatUntilStable>
            <shapes>
                <file>target/srcgen/conversionMultiplier/infer.ttl</file>
                <graph>shacl:qudtFunctions</graph>
            </shapes>
            <data>
                <graph>target:units</graph>
                <graph>target:prefixes</graph>
            </data>
            <inferred>
                <graph>inferred:conversionMultiplier</graph>
                <file>target/inferred/conversionMultiplier.ttl</file>
            </inferred>
        </shaclInfer>
        <add>
            <graph>inferred:conversionMultiplier</graph>
            <toGraph>target:units</toGraph>
        </add>
        <write>
            <graph>target:units</graph>
        </write>
    </steps>
</pipeline>